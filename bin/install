#!/usr/bin/env bash

set -eo pipefail

DOWNLOAD_URL="https://github.com/realm/SwiftLint/releases/download/$ASDF_INSTALL_VERSION/portable_swiftlint.zip"

curl_cmd="curl -s"
if [ -n "$GITHUB_API_TOKEN" ]; then
    curl_cmd="$curl_cmd -H \"Authorization: token $GITHUB_API_TOKEN\""
fi
curl_cmd="$curl_cmd $DESIRED_RELEASE_URL"

# Download the zipped swiftlint file
mkdir -p "$ASDF_INSTALL_PATH/bin"
SWIFTLINT_DOWNLOAD_PATH="$ASDF_INSTALL_PATH/swiftlint.zip"
curl "$DOWNLOAD_URL" -L -o "$SWIFTLINT_DOWNLOAD_PATH" 2>/dev/null

# unzip swiftlint from the archive and delete the archive afterwards
unzip -o "$SWIFTLINT_DOWNLOAD_PATH" swiftlint -d "$ASDF_INSTALL_PATH/bin"
rm "$SWIFTLINT_DOWNLOAD_PATH"
